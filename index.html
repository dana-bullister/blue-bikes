<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Blue Bikes</title>
  <script src="https://d3js.org/d3.v4.js"></script>
</head>

<body>

  <!-- div that will contain visualization -->
  <div id="chart_area"></div>

  <script>
    let chart_area_padding = {
        top: 70,
        right: 50,
        bottom: 50,
        left: 55
      },

      chart_area_width = 460,
      chart_area_height = 400,
      graph_width = chart_area_width - chart_area_padding.left - chart_area_padding.right,
      graph_height = chart_area_height - chart_area_padding.top - chart_area_padding.bottom;

    // set parameters for the maximum and minimum data points to be displayed
    let x_val_min = 0,
      x_val_max = 1440,
      y_val_min = 0,
      y_val_max = 120;

    let chart_area = d3.select("#chart_area")
      .attr("id", "chart_area")

    let chart_background = chart_area
      .append("svg")
      .attr("id", "chart_background")
      .attr("width", chart_area_width)
      .attr("height", chart_area_height)
      .attr("style", "background: lightgrey");

    // chart title
    chart_background.append("text")
      .attr("text-anchor", "middle")
      .attr("x", (graph_width / 2) + chart_area_padding.left)
      .attr("y", chart_area_padding.top / 2)
      .text("Bluebike Trip Duration By Time Of Day");

    // add x-axis label
    chart_background.append("text")
      .attr("text-anchor", "middle")
      .attr("x", (graph_width / 2) + chart_area_padding.left)
      .attr("y", graph_height + chart_area_padding.top + 39)
      .text("Trip Start Time");

    // add y-axis label
    chart_background.append("text")
      .attr("text-anchor", "middle")
      .attr("transform", "rotate(-90)")
      .attr("y", chart_area_padding.left / 2.5)
      .attr("x", -chart_area_padding.top - graph_height / 2)
      .text("Trip Duration (In Minutes)")

    let graph_elems = chart_background
      .append("g")
      .attr("id", "graph_elems")
      .attr("transform", "translate(" + chart_area_padding.left + "," + chart_area_padding.top + ")");

    // read data
    d3.csv("bluebikedatatimeinmin.csv", function(bike_data) {

      // add x axis
      let x = d3.scaleLinear()
        .domain([0, 0]) // start with all points collapsed on the left axis (they will animate to the correct location upon load)
        .range([0, graph_width]);

      let x_axis = graph_elems
        .append('g')
        .attr("id", "x_axis")
        .attr("transform", "translate(0," + graph_height + ")")
        .call(d3.axisBottom(x));

      // add y axis
      let y = d3.scaleLinear()
        .domain([0, y_val_max])
        .range([graph_height, 0]);

      let y_axis = graph_elems
        .append('g')
        .attr("id", "y_axis")
        .call(d3.axisLeft(y));

      // binding data
      let data_points = graph_elems
        .selectAll("data_points")
        .data(bike_data)
        .enter()
        .append("circle")
        .attr("cx", function(d) {
          return x(d.tripStartTime)
        })
        .attr("cy", function(d) {
          return y(d.tripDuration)
        })
        .attr("class", "data_point")
        .attr("fill", "rgb(63,72,204)")
        .attr("r", 1);

      // animate data points to travel to their x-coordinate location from the left
      x.domain([0, x_val_max]); // by first adjusting the domain of the x-axis

      chart_background.select("#x_axis")
        .transition()
        .duration(500)
        .call(d3.axisBottom(x));

      // transition the points to their correct location
      data_points
        .transition()
        .delay(function(d, i) {
          return (i / 1)
        })
        .duration(2000)
        .attr("cx", function(d) {
          return x(d.tripStartTime);
        })
        .attr("cy", function(d) {
          return y(d.tripDuration);
        })

    });
  </script>
</body>

</html>